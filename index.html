<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forex Growth Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-6">

<div class="max-w-lg w-full space-y-6">
  <h1 class="text-3xl font-bold text-center mb-4">📈 Forex Growth Tracker</h1>

  <!-- Auth -->
  <div id="auth" class="bg-gray-800 p-6 rounded-lg shadow space-y-3">
    <input id="email" type="email" placeholder="Email" class="w-full p-3 rounded bg-gray-700 border border-gray-600">
    <input id="password" type="password" placeholder="Password" class="w-full p-3 rounded bg-gray-700 border border-gray-600">
    <button onclick="signIn()" class="w-full bg-blue-600 py-3 rounded hover:bg-blue-700">Sign In / Register</button>
    <button onclick="signOut()" class="w-full bg-red-600 py-3 rounded hover:bg-red-700">Sign Out</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden space-y-6">

    <!-- Stats -->
    <div class="bg-gray-800 p-6 rounded-lg shadow space-y-2">
      <h2 class="text-2xl font-semibold mb-2">💰 Account Summary</h2>
      <p><strong>Starting Balance:</strong> ₹1000</p>
      <p><strong>Current Balance:</strong> ₹<span id="currentBalance">1000</span></p>
      <p><strong>Today's Target (+30%):</strong> ₹<span id="todaysTarget">1300</span></p>
      <p><strong>Expected after 30 days:</strong> ₹<span id="expectedBalance">1238332</span></p>
      <p><strong>Points:</strong> <span id="points">0</span></p>
      <p><strong>Status:</strong> <span id="todayStatus" class="font-bold">Not completed</span></p>
    </div>

    <!-- Log Entry -->
    <div class="bg-gray-800 p-6 rounded-lg shadow space-y-3">
      <h2 class="text-xl mb-2">📒 Log New Trade</h2>
      <input id="amount" type="number" placeholder="Profit (+) or Loss (-)" class="w-full p-3 rounded bg-gray-700">
      <button onclick="addEntry()" class="w-full bg-green-600 py-3 rounded hover:bg-green-700">Add Entry</button>
    </div>

    <!-- Motivation -->
    <div class="bg-gray-800 p-6 rounded-lg shadow space-y-3">
      <h2 class="text-xl mb-2">🌟 Get Motivated</h2>
      <button onclick="getMotivation()" class="w-full bg-purple-600 py-3 rounded hover:bg-purple-700">Inspire Me</button>
      <p id="aiResponse" class="mt-3 text-gray-300"></p>
    </div>

    <!-- Graph -->
    <div class="bg-gray-800 p-6 rounded-lg shadow">
      <canvas id="balanceChart" height="200"></canvas>
    </div>

    <!-- Calendar Summary -->
    <div class="bg-gray-800 p-6 rounded-lg shadow">
      <h2 class="text-xl mb-4">📅 Daily Summary</h2>
      <div id="calendar" class="grid grid-cols-3 gap-2"></div>
    </div>

    <!-- Log History -->
    <div class="bg-gray-800 p-6 rounded-lg shadow">
      <h2 class="text-xl mb-4">📝 Log History</h2>
      <div id="logHistory"></div>
    </div>

  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCW1z29xfd-rGjgW3LMQKp2N8sc2gEOOp0",
  authDomain: "ghrttr.firebaseapp.com",
  projectId: "ghrttr",
  storageBucket: "ghrttr.appspot.com",
  messagingSenderId: "100657420020",
  appId: "1:100657420020:web:466bc40d05a9807e17b0a1",
  measurementId: "G-1Y7RR0WJGL"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let userId = null;
let balance = 1000;
let points = 0;
let entries = [];

function signIn() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email, password)
    .catch(() => auth.createUserWithEmailAndPassword(email, password));
}
function signOut() { auth.signOut(); }

auth.onAuthStateChanged(user => {
  if (user) {
    userId = user.uid;
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('auth').classList.add('hidden');
    loadData();
  } else {
    userId = null;
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('auth').classList.remove('hidden');
  }
});

async function loadData() {
  const doc = await db.collection('users').doc(userId).get();
  if (doc.exists) {
    const data = doc.data();
    balance = data.balance || 1000;
    points = data.points || 0;
    entries = data.entries || [];
  }
  updateUI();
}

async function addEntry() {
  const amt = parseFloat(document.getElementById('amount').value);
  if (isNaN(amt)) return;
  balance += amt;
  points += amt > 0 ? 10 : -5;
  entries.push({ date: new Date().toISOString().split('T')[0], amount: amt });
  await db.collection('users').doc(userId).set({ balance, points, entries });
  document.getElementById('amount').value = '';
  updateUI();
}

function updateUI() {
  const todayDate = new Date().toISOString().split('T')[0];
  const todaySum = entries.filter(e => e.date === todayDate)
                          .reduce((acc, e) => acc + e.amount, 0);

  const todaysTarget = balance / (1 + todaySum / balance) * 1.3;
  const achieved = balance >= todaysTarget;

  document.getElementById('currentBalance').textContent = balance.toFixed(2);
  document.getElementById('todaysTarget').textContent = (balance * 1.3).toFixed(2);
  document.getElementById('expectedBalance').textContent = (balance * Math.pow(1.3,30)).toFixed(2);
  document.getElementById('points').textContent = points;
  document.getElementById('todayStatus').textContent = achieved ? "Completed ✅" : "Not completed";

  // Calendar summary
  const calendarDiv = document.getElementById('calendar');
  calendarDiv.innerHTML = '';
  const daily = {};
  entries.forEach(e => daily[e.date] = (daily[e.date]||0)+e.amount);
  Object.keys(daily).sort().forEach(date => {
    const amt = daily[date];
    calendarDiv.innerHTML += `<div class="p-2 rounded text-center ${amt>=0?'bg-green-600':'bg-red-600'}">
      ${date}<br/>₹${amt.toFixed(2)}
    </div>`;
  });

  // Graph
  const ctx = document.getElementById('balanceChart').getContext('2d');
  if (window.chartInstance) window.chartInstance.destroy();
  const balancesOverTime = [];
  let tempBal = 1000;
  entries.forEach(e => { tempBal += e.amount; balancesOverTime.push(tempBal); });
  window.chartInstance = new Chart(ctx, {
    type: 'line',
    data: { labels: balancesOverTime.map((_,i)=>i+1), datasets: [{
      label:'Balance', data: balancesOverTime, borderColor:'lime', tension:0.3
    }]},
    options: {scales: {x:{ticks:{color:'white'}},y:{ticks:{color:'white'}}},plugins:{legend:{labels:{color:'white'}}}}
  });

  // Log history
  const logDiv = document.getElementById('logHistory');
  logDiv.innerHTML = '';
  entries.slice().reverse().forEach((e,i) => {
    logDiv.innerHTML += `<div class="p-2 mb-1 bg-gray-700 rounded flex justify-between">
      <span>${e.date}: ₹${e.amount.toFixed(2)}</span>
      <button onclick="deleteEntry(${entries.length-1-i})" class="bg-red-600 px-2 rounded">X</button>
    </div>`;
  });
}

async function deleteEntry(index) {
  const removed = entries.splice(index,1)[0];
  balance -= removed.amount;
  points -= removed.amount > 0 ? 10 : -5;
  await db.collection('users').doc(userId).set({ balance, points, entries });
  updateUI();
}

// Gemini just for motivation
async function getMotivation() {
  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyDdp0THfzp04ORFoxLe6rkejyJGDRHf3N4`, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ contents: [{ parts:[{text:"Give me a short motivational message to keep going with my forex trading goals."}] }]})
  });
  const data = await res.json();
  document.getElementById('aiResponse').textContent = data.candidates?.[0]?.content?.parts?.[0]?.text || "Stay strong!";
}

// PWA
if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>
